/*
 * jQuery Address Plugin v1.5
 * http://www.asual.com/jquery/address/
 *
 * Copyright (c) 2009-2010 Rostislav Hristov
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * Date: 2012-11-18 23:51:44 +0200 (Sun, 18 Nov 2012)
 */
(function(e){var t={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS";this.webkit=navigator.userAgent?navigator.userAgent.toString().toLowerCase().indexOf("webkit")!=-1:false},searchString:function(e){for(var t=0;t<e.length;t++){var n=e[t].string;var r=e[t].prop;this.versionSearchString=e[t].versionSearch||e[t].identity;if(n){if(n.indexOf(e[t].subString)!=-1)return e[t].identity}else if(r)return e[t].identity}},searchVersion:function(e){var t=e.indexOf(this.versionSearchString);if(t==-1)return;return parseFloat(e.substring(t+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};t.init();e.address=function(){var n=function(t){var n=e.extend(e.Event(t),function(){var t={},n=e.address.parameterNames();for(var r=0,i=n.length;r<i;r++){t[n[r]]=e.address.parameter(n[r])}return{value:e.address.value(),path:e.address.path(),pathNames:e.address.pathNames(),parameterNames:n,parameters:t,queryString:e.address.queryString()}}.call(e.address));e(e.address).trigger(n);return n},r=function(e){return Array.prototype.slice.call(e)},i=function(t,n,r){e().bind.apply(e(e.address),Array.prototype.slice.call(arguments));return e.address},s=function(t,n){e().unbind.apply(e(e.address),Array.prototype.slice.call(arguments));return e.address},o=function(){return z.pushState&&j.state!==C},u=function(){return("/"+W.pathname.replace(new RegExp(j.state),"")+W.search+(a()?"#"+a():"")).replace(J,"/")},a=function(){var e=W.href.indexOf("#");return e!=-1?p(W.href.substr(e+1),B):""},f=function(){return o()?u():a()},l=function(){try{return top.document!==C&&top.document.title!==C?top:window}catch(e){return window}},c=function(){return"javascript"},h=function(e){e=e.toString();return(j.strict&&e.substr(0,1)!="/"?"/":"")+e},p=function(e,t){if(j.crawlable&&t){return(e!==""?"!":"")+e}return e.replace(/^\!/,"")},d=function(e,t){return parseInt(e.css(t),10)},v=function(){if(!nt){var e=f(),t=decodeURI(ut)!=decodeURI(e);if(t){if(I&&F<7){W.reload()}else{if(I&&!Q&&j.history){V(b,50)}_old=ut;ut=e;m(B)}}}},m=function(e){var t=n(_),r=n(e?D:P);V(y,10);if(t.isDefaultPrevented()||r.isDefaultPrevented()){g()}},g=function(){ut=_old;if(o()){z.popState({},"",j.state.replace(/\/$/,"")+(ut===""?"/":ut))}else{nt=H;if(q){if(j.history){W.hash="#"+p(ut,H)}else{W.replace("#"+p(ut,H))}}else if(ut!=f()){if(j.history){W.hash="#"+p(ut,H)}else{W.replace("#"+p(ut,H))}}if(I&&!Q&&j.history){V(b,50)}if(q){V(function(){nt=B},1)}else{nt=B}}},y=function(){if(j.tracker!=="null"&&j.tracker!==k){var t=e.isFunction(j.tracker)?j.tracker:R[j.tracker],n=(W.pathname+W.search+(e.address&&!o()?e.address.value():"")).replace(/\/\//,"/").replace(/^\/$/,"");if(e.isFunction(t)){t(n)}else if(e.isFunction(R.urchinTracker)){R.urchinTracker(n)}else if(R.pageTracker!==C&&e.isFunction(R.pageTracker._trackPageview)){R.pageTracker._trackPageview(n)}else if(R._gaq!==C&&e.isFunction(R._gaq.push)){R._gaq.push(["_trackPageview",decodeURI(n)])}}},b=function(){var e=c()+":"+B+";document.open();document.writeln('<html><head><title>"+U.title.replace(/\'/g,"\\'")+"</title><script>var "+L+' = "'+encodeURIComponent(f()).replace(/\'/g,"\\'")+(U.domain!=W.hostname?'";document.domain="'+U.domain:"")+'";</'+"script></head></html>');document.close();";if(F<7){G.src=e}else{G.contentWindow.location.replace(e)}},w=function(){if(Z&&et!=-1){var e,t,n=Z.substr(et+1).split("&");for(e=0;e<n.length;e++){t=n[e].split("=");if(/^(autoUpdate|crawlable|history|strict|wrap)$/.test(t[0])){j[t[0]]=isNaN(t[1])?/^(true|yes)$/i.test(t[1]):parseInt(t[1],10)!==0}if(/^(state|tracker)$/.test(t[0])){j[t[0]]=t[1]}}Z=k}_old=ut;ut=f()},E=function(){if(!rt){rt=H;w();var t=function(){S.call(this);N.call(this)},r=e("body").ajaxComplete(t);t();if(j.wrap){var i=e("body > *").wrapAll('<div style="padding:'+(d(r,"marginTop")+d(r,"paddingTop"))+"px "+(d(r,"marginRight")+d(r,"paddingRight"))+"px "+(d(r,"marginBottom")+d(r,"paddingBottom"))+"px "+(d(r,"marginLeft")+d(r,"paddingLeft"))+'px;" />').parent().wrap('<div id="'+L+'" style="height:100%;overflow:auto;position:relative;'+(q&&!window.statusbar.visible?"resize:both;":"")+'" />');e("html, body").css({height:"100%",margin:0,padding:0,overflow:"hidden"});if(q){e('<style type="text/css" />').appendTo("head").text("#"+L+"::-webkit-resizer { background-color: #fff; }")}}if(I&&!Q){var s=U.getElementsByTagName("frameset")[0];G=U.createElement((s?"":"i")+"frame");G.src=c()+":"+B;if(s){s.insertAdjacentElement("beforeEnd",G);s[s.cols?"cols":"rows"]+=",0";G.noResize=H;G.frameBorder=G.frameSpacing=0}else{G.style.display="none";G.style.width=G.style.height=0;G.tabIndex=-1;U.body.insertAdjacentElement("afterBegin",G)}V(function(){e(G).bind("load",function(){var e=G.contentWindow;_old=ut;ut=e[L]!==C?e[L]:"";if(ut!=f()){m(B);W.hash=p(ut,H)}});if(G.contentWindow[L]===C){b()}},50)}V(function(){n("init");m(B)},1);if(!o()){if(I&&F>7||!I&&Q){if(R.addEventListener){R.addEventListener(O,v,B)}else if(R.attachEvent){R.attachEvent("on"+O,v)}}else{X(v,50)}}if("state"in window.history){e(window).trigger("popstate")}}},S=function(){var t,n=e("a"),r=n.size(),i=1,s=-1,o='[rel*="address:"]',u=function(){if(++s!=r){t=e(n.get(s));if(t.is(o)){t.address(o)}V(u,i)}};V(u,i)},x=function(){if(decodeURI(ut)!=decodeURI(f())){_old=ut;ut=f();m(B)}},T=function(){if(R.removeEventListener){R.removeEventListener(O,v,B)}else if(R.detachEvent){R.detachEvent("on"+O,v)}},N=function(){if(j.crawlable){var t=W.pathname.replace(/\/$/,""),n="_escaped_fragment_";if(e("body").html().indexOf(n)!=-1){e('a[href]:not([href^=http]), a[href*="'+document.domain+'"]').each(function(){var r=e(this).attr("href").replace(/^http:/,"").replace(new RegExp(t+"/?$"),"");if(r===""||r.indexOf(n)!=-1){e(this).attr("href","#"+encodeURI(decodeURIComponent(r.replace(new RegExp("/(.*)\\?"+n+"=(.*)$"),"!$2"))))}})}}},C,k=null,L="jQueryAddress",A="string",O="hashchange",M="init",_="change",D="internalChange",P="externalChange",H=true,B=false,j={autoUpdate:H,crawlable:B,history:H,strict:H,wrap:B},F=parseFloat(t.version),I=!e.support.opacity,q=t.browser=="Chrome"||t.browser=="Safari"||t.webkit,R=l(),U=R.document,z=R.history,W=R.location,X=setInterval,V=setTimeout,J=/\/{2,9}/g,K=navigator.userAgent,Q="on"+O in R,G,Y,Z=e("script:last").attr("src"),et=Z?Z.indexOf("?"):-1,tt=U.title,nt=B,rt=B,it=H,st=B,ot={},ut=f();_old=ut;if(I){F=parseFloat(K.substr(K.indexOf("MSIE")+4));if(U.documentMode&&U.documentMode!=F){F=U.documentMode!=8?7:8}var at=U.onpropertychange;U.onpropertychange=function(){if(at){at.call(U)}if(U.title!=tt&&U.title.indexOf("#"+f())!=-1){U.title=tt}}}if(z.navigationMode){z.navigationMode="compatible"}if(document.readyState=="complete"){var ft=setInterval(function(){if(e.address){E();clearInterval(ft)}},50)}else{w();e(E)}e(window).bind("popstate",x).bind("unload",T);return{bind:function(e,t,n){return i.apply(this,r(arguments))},unbind:function(e,t){return s.apply(this,r(arguments))},init:function(e,t){return i.apply(this,[M].concat(r(arguments)))},change:function(e,t){return i.apply(this,[_].concat(r(arguments)))},internalChange:function(e,t){return i.apply(this,[D].concat(r(arguments)))},externalChange:function(e,t){return i.apply(this,[P].concat(r(arguments)))},baseURL:function(){var e=W.href;if(e.indexOf("#")!=-1){e=e.substr(0,e.indexOf("#"))}if(/\/$/.test(e)){e=e.substr(0,e.length-1)}return e},autoUpdate:function(e){if(e!==C){j.autoUpdate=e;return this}return j.autoUpdate},crawlable:function(e){if(e!==C){j.crawlable=e;return this}return j.crawlable},history:function(e){if(e!==C){j.history=e;return this}return j.history},state:function(e){if(e!==C){j.state=e;var t=u();if(j.state!==C){if(z.pushState){if(t.substr(0,3)=="/#/"){W.replace(j.state.replace(/^\/$/,"")+t.substr(2))}}else if(t!="/"&&t.replace(/^\/#/,"")!=a()){V(function(){W.replace(j.state.replace(/^\/$/,"")+"/#"+t)},1)}}return this}return j.state},strict:function(e){if(e!==C){j.strict=e;return this}return j.strict},tracker:function(e){if(e!==C){j.tracker=e;return this}return j.tracker},wrap:function(e){if(e!==C){j.wrap=e;return this}return j.wrap},update:function(){st=H;this.value(ut);st=B;return this},title:function(e){if(e!==C){V(function(){tt=U.title=e;if(it&&G&&G.contentWindow&&G.contentWindow.document){G.contentWindow.document.title=e;it=B}},50);return this}return U.title},value:function(e){if(e!==C){e=h(e);if(e=="/"){e=""}if(ut==e&&!st){return}_old=ut;ut=e;if(j.autoUpdate||st){m(H);if(o()){z[j.history?"pushState":"replaceState"]({},"",j.state.replace(/\/$/,"")+(ut===""?"/":ut))}else{nt=H;if(q){if(j.history){W.hash="#"+p(ut,H)}else{W.replace("#"+p(ut,H))}}else if(ut!=f()){if(j.history){W.hash="#"+p(ut,H)}else{W.replace("#"+p(ut,H))}}if(I&&!Q&&j.history){V(b,50)}if(q){V(function(){nt=B},1)}else{nt=B}}}return this}return h(ut)},path:function(e){if(e!==C){var t=this.queryString(),n=this.hash();this.value(e+(t?"?"+t:"")+(n?"#"+n:""));return this}return h(ut).split("#")[0].split("?")[0]},pathNames:function(){var e=this.path(),t=e.replace(J,"/").split("/");if(e.substr(0,1)=="/"||e.length===0){t.splice(0,1)}if(e.substr(e.length-1,1)=="/"){t.splice(t.length-1,1)}return t},queryString:function(e){if(e!==C){var t=this.hash();this.value(this.path()+(e?"?"+e:"")+(t?"#"+t:""));return this}var n=ut.split("?");return n.slice(1,n.length).join("?").split("#")[0]},parameter:function(t,n,r){var i,s;if(n!==C){var o=this.parameterNames();s=[];n=n===C||n===k?"":n.toString();for(i=0;i<o.length;i++){var u=o[i],a=this.parameter(u);if(typeof a==A){a=[a]}if(u==t){a=n===k||n===""?[]:r?a.concat([n]):[n]}for(var f=0;f<a.length;f++){s.push(u+"="+a[f])}}if(e.inArray(t,o)==-1&&n!==k&&n!==""){s.push(t+"="+n)}this.queryString(s.join("&"));return this}n=this.queryString();if(n){var l=[];s=n.split("&");for(i=0;i<s.length;i++){var c=s[i].split("=");if(c[0]==t){l.push(c.slice(1).join("="))}}if(l.length!==0){return l.length!=1?l:l[0]}}},parameterNames:function(){var t=this.queryString(),n=[];if(t&&t.indexOf("=")!=-1){var r=t.split("&");for(var i=0;i<r.length;i++){var s=r[i].split("=")[0];if(e.inArray(s,n)==-1){n.push(s)}}}return n},hash:function(e){if(e!==C){this.value(ut.split("#")[0]+(e?"#"+e:""));return this}var t=ut.split("#");return t.slice(1,t.length).join("#")}}}();e.fn.address=function(t){var n;if(typeof t=="string"){n=t;t=undefined}if(!e(this).attr("address")){var r=function(n){if(n.shiftKey||n.ctrlKey||n.metaKey||n.which==2){return true}if(e(this).is("a")){n.preventDefault();var r=t?t.call(this):/address:/.test(e(this).attr("rel"))?e(this).attr("rel").split("address:")[1].split(" ")[0]:e.address.state()!==undefined&&!/^\/?$/.test(e.address.state())?e(this).attr("href").replace(new RegExp("^(.*"+e.address.state()+"|\\.)"),""):e(this).attr("href").replace(/^(#\!?|\.)/,"");e.address.value(r)}};e(n?n:this).on("click",r).on("submit",function(n){if(e(this).is("form")){n.preventDefault();var r=e(this).attr("action"),i=t?t.call(this):(r.indexOf("?")!=-1?r.replace(/&$/,""):r+"?")+e(this).serialize();e.address.value(i)}}).attr("address",true)}return this}})(jQuery)